# PRD - MTR Maintenance Scheduling & Compliance Control Tool

## Background & Context

WeMaintain maintains lifts and escalators in the Hong Kong MTR network under a contract requiring maintenance every 14 days, always during the night shift (23:00–05:00).
Each unit has a committed recurring date (e.g., every second Wednesday night).

Today's process is fragmented and Excel-based, resulting in:
- Engineers missing committed dates
- Difficulty coordinating rescheduling (MTR approvals required)
- Repeated customer frustration
- Weak visibility over impending non-compliance
- Metrics that only reveal issues monthly, long after the damage is done

This tool aims to restore predictability, tighten control, and prevent contract violations.

## Problem Statement

The MTR contract tolerates 0 missed maintenance cycles.

Ops currently has:
- No early-warning system for risks
- No structured tracking of commitments at the 14-day level
- Delayed visibility on engineer habits
- No scalable communication system for a mostly Chinese-speaking technician base

As a result:
- Compliance breaches occur
- MTR escalates issues
- Engineers face operational uncertainty
- Supervisors cannot intervene in time

The existing workflow is unsuitable for the contract's strict requirements.

## Goals & Objectives

### Primary Goal
Ensure on-time maintenance completion for every MTR unit, with adherence measured against the strict 14-day cycle and a predictable ±3–5 day operational tolerance.

### Secondary Goals
- Detect risks before deadlines are breached
- Notify engineers in Chinese with clear, actionable reminders
- Improve transparency and accountability across engineers and supervisors
- Generate clean, auditable reports for MTR

## Current Organization

### Zones
- **MTR-01 & MTR-02**: HK Station
- **MTR-03**: Kowloon Station
- **MTR-04**: Tsing Yi Station
- **MTR-05**: Olympic Station, Sunny Bay Station, Disney Station, Lai King Station, Lohas Park
- **MTR-06**: Tung Chung Station, Airport Station, Airport Expo Station, Tuen Mun Station

### Schedule Structure
- Bi-weekly servicing for all equipment
- First batch: "A"
- Second batch: "B"
- 2-men team at all times:
  - Engineer 1 = Fixed (dedicated engineer of the zone, must have CP & RW certificates)
  - Engineer 2 = Rotating (based on manpower arrangement)

### Time Slots
- Typically 3 equipment per day at each zone at fixed timing: 23:00, 1:30 & 3:30
- Only units marked in pink are allowed to start servicing at 11pm (earlier slot)

### Schedule Columns
- **Column F (R0 schedule)**: Original maintenance schedule submitted when contract started. "Locked" in MTR system and cannot be changed.
- **Column G (Due date)**: Column F + 14 days. MTRC gives a 14-day allowed window after the original R0 date. This is the latest date the servicing must be completed if missed.
- **Column D (R1 schedule)**: WM's proposed new schedule submitted to MTR. Engineers try to follow this updated schedule.

**Logic**: If the engineer missed the date in column D, he needs to reschedule and complete within the date in column G.

### Work Orders (OR Numbers)
- OR number is the work order number - a unique ID for each visit to the equipment generated by the EAMS system (MTR's portal)
- Serves as a ticket to do the maintenance
- Station master will verify this ID in their system before the servicing
- If the OR number is invalid or not recognised, the Station Master will not allow the engineer to proceed
- Currently Ops team downloads the list of OR numbers from the EAMS system every month
- May be able to download work numbers in bulk for the entire year starting 1-Jan-26

### Completion Tracking
- Maintenance completion is managed via WhatsApp group (co-owned by WM & MTR)
- Every night, once servicing is completed, engineer sends the PM forms (servicing checklist) into the WA groups
- After receiving PM forms in WhatsApp, Vivian (Admin) enters the servicing records into the EAMS system, which serves as the official maintenance log
- In addition to joint WhatsApp group, there are 5 more WA groups to manage each zone
- If engineer missed the servicing, Ops team manage the rescheduling in those groups
- For client side, rescheduling is managed through the summary sheet

## User Stories

### 1. Portfolio Scheduling & Visibility

**US1 — Build and visualize the full portfolio schedule**

As an Ops manager, I want a visual 14-day calendar for all MTR units, so I can see the entire committed maintenance plan at a glance and stop relying on massive spreadsheets.

**US2 — Manage team/engineer assignments**

As a supervisor, I want to assign or reassign engineers to specific units or stations in the recurring schedule, so each night's workload is clearly owned by specific individuals.

### 2. Tracking Execution: Committed Date vs. On-Time Window

**US3 — Track if maintenance happened on the committed date**

As Ops, I want the system to tell me whether maintenance occurred on the precise planned date, so I can measure adherence to the committed plan and minimize unnecessary rescheduling.

**US4 — Track if maintenance happened within the allowed ±3–5 day window**

As Ops, I want to know if the maintenance was still completed within the acceptable operational window, so I can confirm we stayed compliant with MTR even when the committed date was missed.

### 3. Identifying Units Needing Action

**US5 — Surface all units that missed their committed date**

As a supervisor, I want to see every unit that failed its planned night, so I can quickly decide whether action or rescheduling is needed.

**US6 — Surface all units that require rescheduling**

As Ops, I want the system to show all units where the committed night was missed and the new execution night hasn't been set yet, so I can avoid losing track and prevent full 14-day breaches.

**US7 — Surface units already rescheduled**

As Ops, I want to see units that were explicitly moved from their committed date, so I can monitor the volume of deviations and (if needed) justify them to MTR.

**US8 — Remove the "flag upcoming due in 5 days" logic**

This is an intentionally removed requirement. Engineers do 2–3 units per night. If you notify them of every unit that is "due soon," they drown in noise. Instead, the tool focuses on deviations.

### 4. Engineer Notifications (Simplified)

**US9 — Notify engineers only of the units planned for tonight**

As an engineer, I want a single Chinese-language reminder of the units I must complete tonight, so I can focus on what actually matters and avoid overwhelming messages.

**US10 — Notify engineer of missed committed night**

As an engineer, I want a Chinese notification the day after I miss a committed date, so I know I must coordinate with my supervisor immediately.

### 5. Scheduling Rules & Validations

**US12 — Enforce 14-day cycle at scheduling time**

As a system, I need to prevent any schedule that places a unit more than 14 days apart, so Ops cannot accidentally create a contract breach during planning.

**US13 — Auto-classify maintenance results**

As the system, I want to automatically classify each maintenance event as:
- Committed date (best case)
- On-time (±3–5 days)
- Late
- Overdue
- Not completed

So supervisors have clarity without manual calculation.

### 6. Compliance & Behaviour Insights

**US14 — View overdue units per engineer**

As a supervisor, I want to see each engineer sorted by number of overdue units, so I can focus support and intervention where it matters.

**US15 — View % late visits (6-month history)**

As Ops, I want to see an engineer's percentage of late visits over the past 6 months, so I can identify chronic reliability issues vs. occasional slip-ups.

**US16 — Export full audit history**

As Ops, I want to export the complete unit-by-unit history (committed vs execution vs status), so I can provide transparent records to MTR.

### 7. Data Sources

**US17 — Import engineer list**

**US18 — Import unit list**

**US19 — Ingest maintenance completion data**

## Integrations

### Looker Integrations

Same credentials as for project ShiftProto should be used.

- **Engineers List**: Look_ID = 160 (filtered on HK)
- **MTR Devices**: Look_ID = 167
- **Maintenance Visits**: Look_ID = 168 (last 3 months)

### Novu Integrations

Same credentials as for Project ShiftProto should be used.

- Build the workflow using SDK, not the API
- Chinese-language notifications for engineers

## Implementation Status

### Phase 1: Data Sync ✅
- ✅ Project structure setup
- ✅ Database schema design
- ✅ Looker integration utilities
- ✅ Novu integration utilities
- ✅ Basic app structure
- ✅ API endpoints for syncing engineers, devices, and visits from Looker

### Phase 2: Schedule Management API ✅
- ✅ CRUD operations for schedules
- ✅ 14-day cycle validation
- ✅ Schedule assignment/unassignment endpoints
- ✅ Bulk schedule creation

### Phase 3: Engineer Assignment API ✅
- ✅ Engineer assignment endpoints
- ✅ Availability and certification checks
- ✅ Workload tracking per engineer
- ✅ Zone-engineer assignment management

### Phase 4: Calendar & Schedule UI ✅
- ✅ Visual 14-day calendar for schedules
- ✅ Zone and date filtering
- ✅ Status color coding
- ✅ Drag-and-drop schedule rescheduling
- ✅ Schedule card display with equipment details, OR numbers, and deadlines
- ✅ 23:00 slot eligibility indicators

### Phase 5: Work Order Management ✅
- ✅ Work Order CSV upload with validation
- ✅ Automatic slot distribution (11pm-eligible units to SLOT_2300, others distributed across SLOT_0130 and SLOT_0330)
- ✅ Work Order tracking page with tabs (To be validated, To be rescheduled, Completed)
- ✅ Search functionality by Work Order number
- ✅ Upload history and details

### Phase 6: Maintenance Validation & Rescheduling ✅
- ✅ Completion validation workflow (mark as completed or to reschedule)
- ✅ Bulk validation actions
- ✅ Rescheduling interface with slot picker
- ✅ Visual indicators for pending/completed/to reschedule status
- ✅ Deadline tracking and display

### Phase 7: Admin Panel ✅
- ✅ Devices management (view all devices from Looker, edit zone/batch mapping)
- ✅ 23:00 slot settings (manage which devices can use 23:00 slot)
- ✅ Work Order upload and management
- ✅ Zone-engineer assignment interface

### Phase 8: Next Steps (Future)
- [ ] Chinese-language notifications via Novu (workflows configured, not yet triggered)
- [ ] Compliance reporting and analytics
- [ ] Export audit history
- [ ] Engineer performance metrics (% late visits, overdue units per engineer)
- [ ] EAMS integration (when available)

## Sequencing

In the first version, it's ok to still have engineers send back their paper sheet on a daily basis after they completed their service. We could then have the admin very easily flag in the system what's been done or not and use this as a feedback loop. But we'd like to get rid of the secondary WhatsApp group aimed at coordinating and tracking the rescheduling. This could be done directly in the tool.

